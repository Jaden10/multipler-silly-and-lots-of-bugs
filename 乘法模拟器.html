<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Let's do some multiplication!!</title>
    <style>
      body {
        height: 100vh;
        overflow: hidden;
        display: flex;
        align-items: center;
        position: relative;
        justify-content: flex-start;
        flex-direction: column;
        background: linear-gradient(to top left, #28b487, #7dd56f);
      }
      #expression {
        font-family: sans-serif;
        font-size: 90px;
        width: 100%;
        margin-top: 70px;
        margin-bottom: 90px;
        text-align: center;
        color: white;
      }
      #btn-test {
        font-size: 2rem;
        font-weight: 600;
        padding: 1.25rem 3rem;
        margin: 2rem 2rem;
        border: none;
        background-color: #fff;
        color: #444;
        border-radius: 10rem;
        cursor: pointer;
      }
      #btn-review {
        font-size: 25px;
        font-weight: 600;
        padding: 1rem 2rem;
        margin: 1.5rem 6rem;
        background-color: #7dd56f;
        color: #444;
        border-radius: 10rem;
        cursor: pointer;
      }
      #btn-modalClose {
        position: absolute; /* ÁªùÂØπÂÆö‰Ωç */
        top: 5px;
        right: 15px;
        font-size: 50px;
        color: #888;
        background: none;
        border: none;
        cursor: pointer;
      }
      .btnBelow {
        font-size: 1rem;
        font-weight: 600;
        padding: 0.5rem 1rem;
        border: none;
        background-color: #fff;
        color: #444;
        border-radius: 1rem;
        cursor: pointer;
      }
      .test-items {
        display: flex;
        font-size: 2rem;
        font-weight: 600;
        border: none;
        margin-top: 50px;
        margin-bottom: 50px;
        color: #ffffff;
        flex-direction: row;
        gap: 250px;
      }
      .modal {
        top: 44%;
        left: 50%;
        transform: translate(-50%, -50%); /* Á≤æÁ°ÆÂ±Ö‰∏≠ */
        width: 350px;
        height: 400px;
        padding: 20px;
        background-color: white;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        text-align: center;
        position: fixed;
        justify-content: space-between;
        display: flex;
        flex-direction: column;
      }
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="test-items">
      <div id="combos"></div>
      <button class="btnBelow" id="btn-quit">Quit</button>
      <div id="timer"></div>
    </div>
    <button id="btn-test">Timed Test</button>
    <h1 id="expression"></h1>

    <div class="btnBelowAll">
      <button class="btnBelow" id="btn-correct">‚úÖCorrect</button>
      <button class="btnBelow" id="btn-next">Next</button>
      <button class="btnBelow" id="btn-wrong">‚ùåWrong</button>
    </div>

    <div class="modal hidden" id="modal-timesUp">
      <button id="btn-modalClose">√ó</button>
      <h1 id="timesUpText">Times Up!!!</h1>
      <h2 id="modal-combosText"></h2>
      <button class="btnBelow" id="btn-review">Review</button>
    </div>

    <script>
      const h1 = document.getElementById("expression");
      const btnNext = document.querySelector("#btn-next");
      const btnTest = document.querySelector("#btn-test");
      const btnCorrect = document.querySelector("#btn-correct");
      const btnWrong = document.querySelector("#btn-wrong");
      const btnQuit = document.querySelector("#btn-quit");
      const btnReview = document.querySelector("#btn-review");
      const btnModalClose = document.querySelector("#btn-modalClose");
      const combosText = document.querySelector("#combos");
      const timerText = document.querySelector("#timer");
      const timesUpText = document.querySelector("#timesUpText");
      const modal = document.querySelector("#modal-timesUp");
      const modalCombosText = document.querySelector("#modal-combosText");

      let misCollector = [];
      let combos = 0;
      let timer;
      let correctListener, wrongListener;
      let reviewListener, reviewCorrectListener, reviewWrongListener;

      //ÁîüÊàêÈöèÊú∫‰πòÊ≥ïÁöÑÂáΩÊï∞
      const generator = function () {
        const number1 = Math.trunc(Math.random() * 8 + 2);
        const number2 = Math.trunc(Math.random() * 8 + 2);
        h1.innerHTML = `${number1} √ó ${number2}`;
      };
      //ÂàùÂßãÂåñÂáΩÊï∞
      const init = function () {
        btnCorrect.classList.add("hidden");
        btnWrong.classList.add("hidden");
        combosText.classList.add("hidden");
        timerText.classList.add("hidden");
        btnQuit.classList.add("hidden");
        modal.classList.add("hidden");
        btnNext.classList.remove("hidden");
        btnTest.classList.remove("hidden");
        clearInterval(timer);
        misCollector = [];
        combos = 0;
        combosText.innerHTML = `Combos : ${combos}`;
        generator();

        // ÁßªÈô§ÊóßÁöÑ‰∫ã‰ª∂ÁõëÂê¨Âô®ÔºåÈÅøÂÖçÈáçÂ§çÁªëÂÆö
        if (correctListener) {
          btnCorrect.removeEventListener("click", correctListener);
        }
        if (wrongListener) {
          btnWrong.removeEventListener("click", wrongListener);
        }
        if (reviewListener) {
          btnReview.removeEventListener("click", reviewListener);
        }
        if (reviewWrongListener) {
          btnWrong.removeEventListener("click", reviewWrongListener);
        }
        if (reviewCorrectListener) {
          btnWrong.removeEventListener("click", reviewCorrectListener);
        }
      };

      //ÂàùÂßãÂåñ

      init();

      //ÊòæÁ§∫Â§ç‰π†Ê®°Âºè
      const showReviewMode = function () {
        //ÁßªÈô§‰∫ã‰ª∂ÁõëÂê¨Âô®
        if (correctListener) {
          btnCorrect.removeEventListener("click", correctListener);
        }
        if (wrongListener) {
          btnWrong.removeEventListener("click", wrongListener);
        }

        //ÊÅ¢Â§ç UI
        combosText.classList.add("hidden");
        timerText.classList.add("hidden");
        modal.classList.add("hidden");

        loadNextReviewQuestion();
      };

      //ÊòæÁ§∫‰∏ã‰∏Ä‰∏™Â§ç‰π†ÈóÆÈ¢ò
      const loadNextReviewQuestion = function () {
        if (misCollector.length <= 0) {
          generator();
          btnReview.classList.add("hidden");
          timesUpText.classList.add("hidden");
          modalCombosText.innerHTML = "Congrats!üéâYou've cleared all mistakes!";
          modal.classList.remove("hidden");
        }
        h1.innerHTML = misCollector[0];
      };

      //Next‰∫ã‰ª∂
      btnNext.addEventListener("click", generator);

      //ÂÖ≥Èó≠Á™óÂè£
      btnModalClose.addEventListener("click", init);

      // ÂàõÂª∫‰∫ã‰ª∂ÁõëÂê¨Âô®
      correctListener = function () {
        combos++;
        combosText.innerHTML = `Combos : ${combos}`;
        generator();
      };

      wrongListener = function () {
        misCollector.push(h1.innerHTML);
        generator();
      };

      reviewListener = function () {
        showReviewMode();

        btnCorrect.addEventListener("click", reviewCorrectListener);
        btnWrong.addEventListener("click", reviewWrongListener);
      };

      reviewCorrectListener = function () {
        misCollector.shift();
        loadNextReviewQuestion();
      };

      reviewWrongListener = function () {
        misCollector.push(misCollector.shift());
        loadNextReviewQuestion();
      };

      //Timed test‰∫ã‰ª∂
      btnTest.addEventListener("click", function () {
        //Quit‰∫ã‰ª∂
        btnQuit.addEventListener("click", init);
        generator();
        //ËÆ°Êó∂Âô®ÂäüËÉΩ
        const startTimer = function () {
          const tick = function () {
            const min = String(Math.trunc(time / 60)).padStart(2, 0);
            const sec = String(time % 60).padStart(2, 0);

            //ÊòæÁ§∫ÂÄíËÆ°Êó∂
            timerText.innerHTML = `Timer : ${min}:${sec}`;

            //‰∏§ÂàÜÈíüÂêéÂºπÂá∫Á™óÂè£
            if (time === 0) {
              //ÊòæÁ§∫Êï∞ÊçÆÔºåÊ∏ÖÈô§ËÆ°Êó∂Âô®
              clearInterval(timer);
              modal.classList.remove("hidden");
              modalCombosText.innerHTML = `Combos : ${combos}`;

              //btnReview‰∫ã‰ª∂
              btnReview.addEventListener("click", reviewListener);
            }

            time--;
          };

          let time = 120;

          // Call the timer every second
          tick();
          timer = setInterval(tick, 1000);

          return timer;
        };

        //ÊòæÁ§∫ UI
        startTimer();
        btnCorrect.classList.remove("hidden");
        btnWrong.classList.remove("hidden");
        combosText.classList.remove("hidden");
        timerText.classList.remove("hidden");
        btnNext.classList.add("hidden");
        btnTest.classList.add("hidden");
        btnQuit.classList.remove("hidden");

        // ‰∏∫ btnCorrect btnWrong Ê∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨Âô®
        btnCorrect.addEventListener("click", correctListener);
        btnWrong.addEventListener("click", wrongListener);
      });
    </script>
  </body>
</html>
